<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard</title>
    <link rel="stylesheet" href="css/dashboard.css"> <!-- Link to your CSS file -->
    <link rel="stylesheet" href="css/eventdashboard.css"> <!-- Link to your CSS file -->
   <style>
    

.navbar {
    background-color: #333; /* Dark background for the navbar */
    padding: 10px 20px; /* Padding for the navbar */
}

.container {
    display: flex; /* Flexbox for layout */
    justify-content: space-between; /* Space between items */
    align-items: center; /* Center items vertically */
}

.nav-links {
    list-style: none; /* Remove bullet points */
    display: flex; /* Horizontal layout for links */
    margin: 0; /* Remove default margin */
    padding: 0; /* Remove default padding */
}

.nav-links li {
    margin-right: 20px; /* Spacing between items */
    display: flex; /* Use flex to center align items */
    align-items: center; /* Center align items vertically */
}

.nav-links a {
    color: white; /* Text color */
    text-decoration: none; /* Remove underline */
    padding: 8px 12px; /* Padding for links */
    border-radius: 4px; /* Rounded corners */
    transition: background-color 0.3s; /* Smooth transition for hover */
}

.nav-links a:hover {
    background-color: #555; /* Darker background on hover */
}

.profile-pic {
    width: 30px; /* Width of profile picture */
    height: 30px; /* Height of profile picture */
    border-radius: 50%; /* Circle shape */
    margin-right: 8px; /* Space between the image and the link */
    object-fit: cover; /* Ensure the image covers the box */
}

   </style>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <ul class="nav-links">
                <li><a href="/dashboard">Home</a></li>
              
                    <a href="/user/profile">
                        <img src="<%= user.profilePicture %>" alt="Profile Picture" class="profile-pic">
                    </a>
                
                <li><a href="/auth/logout">Logout</a></li>
                <% if (user.isAdmin) { %>
                    <li><a href="/admin/create-event" class="create-event-btn">Create Event</a></li>
                <% } %>
                <li><a href="/eventreq">Request Event</a></li>
            </ul>
        </div>
    </nav>

    <div class="dashboard-content">
        <h1>Welcome, <%= user.name %>!</h1>
        <div class="events-list">
            <% events.forEach(event => { 
                const currentTime = new Date();
                const registrationOpen = currentTime < event.registrationEnd;
                const eventStarted = currentTime >= event.dateOfEvent && currentTime < event.eventEndTime;
                const eventEnded = currentTime > event.eventEndTime;
                const feedbackAvailable = eventEnded && currentTime <= new Date(event.eventEndTime.getTime() + 7 * 24 * 60 * 60 * 1000);
            %>
                <div class="event-item">
                    <div class="event-main-content">
                        <div class="event-image">
                            <img src="/<%= event.eventPoster %>" alt="Event Poster">
                        </div>
                        <div class="event-details">
                            <h3><%= event.eventName %></h3>
                            <p><%= event.description %></p>
                            <p><strong>Venue:</strong> <%= event.venue %></p>
                            <p><strong>Date:</strong> <%= event.dateOfEvent.toLocaleDateString() %></p>
                            <p><strong>Time:</strong> <%= event.eventStartTime %> - <%= event.eventEndTime %></p>
    
                            <!-- Button container to hold buttons side by side -->
<div class="event-buttons">
    <!-- Register button -->
    <% if (registrationOpen) { %>
        <a href="/register/<%= event._id %>" class="register-btn">Register</a>
    <% } else { %>
        <button class="register-btn disabled">Closed</button>
    <% } %>

    <!-- Attendance button -->
    <% if (eventStarted && !eventEnded) { %>
        <a href="/attendance/<%= event._id %>" class="attendance-btn">Mark Attendance</a>
    <% } else { %>
        <button class="attendance-btn disabled" style="font-size:14px;">attendance</button>
    <% } %>

    <!-- Feedback button -->
    <% if (feedbackAvailable) { %>
        <a href="/feedback/<%= event._id %>" class="feedback-btn">Give Feedback</a>
    <% } else { %>
        <button class="feedback-btn disabled" style="font-size:14px;">Feedback</button>
    <% } %>
</div>
                            <!-- Only show delete button for the event creator -->
                            <% if (user._id.toString() === event.creator.toString()) { %>
                                <form action="/admin/deleteevent/<%= event._id %>" method="POST" class="delete-form">
                                    <button type="submit" class="delete-btn">
                                        <img src="/images/bin.png" alt="Delete" class="delete-icon">
                                    </button>
                                </form>
                            <% } %>
                        </div>
                    </div>
                    <div class="registration-stats">
                        <div class="stat-item">
                            <div class="stat-label">Participants</div>
                            <div class="stat-value"><%= event.registeredUsers.length %>/<%= event.maxParticipants %></div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Volunteers</div>
                            <div class="stat-value"><%= event.registeredVolunteers.length %>/<%= event.maxVolunteers %></div>
                        </div>
                    </div>
                </div>
            <% }) %>
        </div>
    </div>
    
    
</body>
</html>
